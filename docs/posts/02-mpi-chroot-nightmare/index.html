<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Down the Rabbit Hole: The MPI and Chroot Nightmare | DGX Spark Deep Dive</title>
<meta name="keywords" content="dgx-spark, mpi, chroot, debugging">
<meta name="description" content="Sometimes the hardest part of debugging isn&#39;t finding the bug - it&#39;s just getting to a clean test environment. Here&#39;s how we spent hours fighting MPI libraries and chroot configurations before we could even start benchmarking.">
<meta name="author" content="Brandon Geraci">
<link rel="canonical" href="https://brandonrc.github.io/dgx-spark-blog/posts/02-mpi-chroot-nightmare/">
<link crossorigin="anonymous" href="/dgx-spark-blog/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://brandonrc.github.io/dgx-spark-blog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://brandonrc.github.io/dgx-spark-blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://brandonrc.github.io/dgx-spark-blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://brandonrc.github.io/dgx-spark-blog/apple-touch-icon.png">
<link rel="mask-icon" href="https://brandonrc.github.io/dgx-spark-blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://brandonrc.github.io/dgx-spark-blog/posts/02-mpi-chroot-nightmare/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="https://brandonrc.github.io/dgx-spark-blog/posts/02-mpi-chroot-nightmare/">
  <meta property="og:site_name" content="DGX Spark Deep Dive">
  <meta property="og:title" content="Down the Rabbit Hole: The MPI and Chroot Nightmare">
  <meta property="og:description" content="Sometimes the hardest part of debugging isn&#39;t finding the bug - it&#39;s just getting to a clean test environment. Here&#39;s how we spent hours fighting MPI libraries and chroot configurations before we could even start benchmarking.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-11-08T11:00:00+00:00">
    <meta property="article:modified_time" content="2025-11-08T11:00:00+00:00">
    <meta property="article:tag" content="Dgx-Spark">
    <meta property="article:tag" content="Mpi">
    <meta property="article:tag" content="Chroot">
    <meta property="article:tag" content="Debugging">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Down the Rabbit Hole: The MPI and Chroot Nightmare">
<meta name="twitter:description" content="Sometimes the hardest part of debugging isn&#39;t finding the bug - it&#39;s just getting to a clean test environment. Here&#39;s how we spent hours fighting MPI libraries and chroot configurations before we could even start benchmarking.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://brandonrc.github.io/dgx-spark-blog/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Down the Rabbit Hole: The MPI and Chroot Nightmare",
      "item": "https://brandonrc.github.io/dgx-spark-blog/posts/02-mpi-chroot-nightmare/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Down the Rabbit Hole: The MPI and Chroot Nightmare",
  "name": "Down the Rabbit Hole: The MPI and Chroot Nightmare",
  "description": "Sometimes the hardest part of debugging isn't finding the bug - it's just getting to a clean test environment. Here's how we spent hours fighting MPI libraries and chroot configurations before we could even start benchmarking.",
  "keywords": [
    "dgx-spark", "mpi", "chroot", "debugging"
  ],
  "articleBody": "The Simple Plan (That Wasn’t Simple) After seeing the mysterious 26GB memory overhead in Docker, my plan was straightforward:\nExtract the container’s filesystem Run the same Python scripts natively Compare the results Done! Ha. Hahahaha. No.\nAttempt 1: Just Run It My first thought: “Let’s just run the Docker scripts on my system. How hard can it be?”\n1 2 python /home/khan/benchmark-spark/benchmarks/trtllm_benchmark.py \\ --model deepseek-ai/DeepSeek-R1-Distill-Qwen-7B What I got: Runtime nightmare.\nM I C o m U d p D u o A l r e t E N E r o r r t r o F o r o r : u : n n d l o E i r b C r m U o p D r i A : . - s c N o a o . p 4 a m 0 b o : l d e u c l a d e n e n v n o i a t c m e e o d p i e s ' n t d e s e n h t s a e o r c r e t r d e t d _ o l b l j m e ' c t f i l e Of course. The container has TensorRT-LLM, specific CUDA versions, MPI libraries, and about a million other dependencies that my host system doesn’t have (or has different versions of).\nOkay, fine. Let’s extract the container and use chroot.\nExtracting the Container Docker containers are just fancy tarballs with layers. To extract:\n1 2 3 4 5 6 7 8 # Export the container filesystem docker create --name temp nvcr.io/nvidia/tensorrt-llm/release:spark-single-gpu-dev docker export temp \u003e container.tar docker rm temp # Extract to a directory mkdir -p /home/khan/container-rootfs sudo tar -xf container.tar -C /home/khan/container-rootfs Now I have the entire container filesystem at /home/khan/container-rootfs/. Cool!\nThe MPI Library Hunt Begins Time to run something:\n1 sudo chroot /home/khan/container-rootfs python3 /workspace/benchmarks/trtllm_benchmark.py New error:\n[ M T P R I T - E L r L r M o ] r : [ I u ] n d M e P f I i n s e i d z e s : y m 1 b , o l r : a n u k c : s _ 0 c o n f i g _ d o c _ n o p What? Let me check which MPI it’s using:\n1 2 which mpirun # /usr/bin/mpirun ← System MPI! Ah. The chroot is finding the system’s MPI (installed at /usr/bin/mpirun) instead of the container’s MPI (at /opt/hpcx/ompi/bin/mpirun inside the rootfs).\nThe PATH Dance TensorRT-LLM uses HPC-X OpenMPI from NVIDIA. The container has it at /opt/hpcx/ompi/. But when I chroot, the PATH still points to system binaries first.\nSolution: Explicitly set PATH to prioritize container binaries.\n1 export PATH=\"/opt/hpcx/ompi/bin:$PATH\" Run again… new error:\nm p i r u n : e r r o r w h i l e l o a d i n g s h a r e d l i b r a r i e s : l i b u c s . s o . 0 : c a n n o t o p e n s h a r e d o b j e c t f i l e The MPI binary is now correct, but it can’t find its libraries!\nThe LD_LIBRARY_PATH Saga The container’s MPI needs libraries from /opt/hpcx/ompi/lib/, but LD_LIBRARY_PATH doesn’t include it.\n1 export LD_LIBRARY_PATH=\"/opt/hpcx/ompi/lib:$LD_LIBRARY_PATH\" Run again… DIFFERENT error:\ns y m b o l l o o k u p e r r o r : o p t / h p c x / o m p i / l i b / l i b u c c . s o . 1 : u n d e f i n e d s y m b o l : u c p _ w o r k e r _ p r o g r e s s Wait, what? Now it’s finding the HPC-X libraries but they’re conflicting with system libraries!\nThe Real Problem Here’s what was happening:\nThe system has OpenMPI installed (libmpi.so) The container has HPC-X OpenMPI (/opt/hpcx/ompi/lib/libmpi.so) TensorRT-LLM needs the HPC-X version But the dynamic linker was mixing system and container libraries The fix: Put container libraries at the FRONT of LD_LIBRARY_PATH:\n1 export LD_LIBRARY_PATH=\"/opt/hpcx/ompi/lib:/usr/local/lib/python3.12/dist-packages/tensorrt_libs:$LD_LIBRARY_PATH\" Finally, MPI works!\nThe CUDA Version Surprise Got MPI working. Started a benchmark. New error:\nR u n t i m e E r r o r : T r i t o n o n l y s u p p o r t s C U D A 1 0 . 0 o r h i g h e r , b u t g o t C U D A v e r s i o n : 1 3 . 0 Wait, CUDA 13.0? We’re using CUDA 12.9!\nTurns out: The system symlink /usr/local/cuda pointed to CUDA 13.0. The container needs CUDA 12.9.\nFix:\n1 2 export CUDA_HOME=\"/usr/local/cuda-12.9\" export PATH=\"/usr/local/cuda-12.9/bin:$PATH\" The Full Chroot Wrapper Script After all this pain, I created a proper chroot wrapper that handles everything:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 #!/bin/bash SCRIPT_DIR=\"/home/khan/container-rootfs\" # Mount necessary filesystems sudo mount -t proc /proc \"${SCRIPT_DIR}/proc\" sudo mount --rbind /sys \"${SCRIPT_DIR}/sys\" sudo mount --rbind /dev \"${SCRIPT_DIR}/dev\" sudo mount --bind /home \"${SCRIPT_DIR}/home\" sudo mount --bind /data \"${SCRIPT_DIR}/data\" # DNS resolution sudo cp /etc/resolv.conf \"${SCRIPT_DIR}/etc/resolv.conf\" # Run in chroot with proper environment sudo chroot \"${SCRIPT_DIR}\" /usr/bin/env -i \\ HOME=/root \\ PATH=\"/opt/hpcx/ompi/bin:/usr/local/cuda-12.9/bin:/usr/local/bin:/usr/bin:/bin\" \\ LD_LIBRARY_PATH=\"/opt/hpcx/ompi/lib:/usr/local/lib/python3.12/dist-packages/tensorrt_libs:/usr/local/cuda-12.9/lib64\" \\ CUDA_HOME=\"/usr/local/cuda-12.9\" \\ PYTHONPATH=\"/usr/local/lib/python3.12/dist-packages\" \\ \"$@\" # Cleanup: unmount everything sudo umount \"${SCRIPT_DIR}/data\" sudo umount \"${SCRIPT_DIR}/home\" sudo umount \"${SCRIPT_DIR}/dev\" sudo umount \"${SCRIPT_DIR}/sys\" sudo umount \"${SCRIPT_DIR}/proc\" Now I can run:\n1 ./run_in_rootfs.sh python3 /home/khan/benchmark-spark/benchmarks/trtllm_benchmark.py And it actually works.\nLessons Learned Library paths matter: System vs container libraries will bite you Environment is everything: PATH, LD_LIBRARY_PATH, CUDA_HOME all critical MPI is picky: HPC-X OpenMPI isn’t interchangeable with system OpenMPI Filesystem mounts: Need /proc, /sys, /dev, /home, and /data bind mounts DNS matters: Even forgot /etc/resolv.conf initially! The Hard Part Is Over… Right? With a working chroot environment, I could finally start benchmarking. But getting here took hours of debugging library paths and runtime errors.\nSometimes I wonder if this is why people just accept Docker’s overhead - at least it works out of the box!\nBut now that we have both Docker and native environments working, we can actually compare them fairly. And that’s where things get interesting…\nIn the next post: What Grace Hopper’s unified memory architecture actually means, and why Docker’s cgroups don’t understand it.\nPrevious: ← Part 1: The Mystery\nNext: Part 3: The Unified Memory Revelation →\nGitHub Repo: benchmark-spark\n",
  "wordCount" : "1141",
  "inLanguage": "en",
  "datePublished": "2025-11-08T11:00:00Z",
  "dateModified": "2025-11-08T11:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Brandon Geraci"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://brandonrc.github.io/dgx-spark-blog/posts/02-mpi-chroot-nightmare/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "DGX Spark Deep Dive",
    "logo": {
      "@type": "ImageObject",
      "url": "https://brandonrc.github.io/dgx-spark-blog/favicon.ico"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://brandonrc.github.io/dgx-spark-blog/" accesskey="h" title="DGX Spark Deep Dive (Alt + H)">DGX Spark Deep Dive</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://brandonrc.github.io/dgx-spark-blog/posts/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://brandonrc.github.io/dgx-spark-blog/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/brandonrc/benchmark-spark" title="Results">
                    <span>Results</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://brandonrc.github.io/dgx-spark-blog/">Home</a>&nbsp;»&nbsp;<a href="https://brandonrc.github.io/dgx-spark-blog/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Down the Rabbit Hole: The MPI and Chroot Nightmare
    </h1>
    <div class="post-description">
      Sometimes the hardest part of debugging isn&#39;t finding the bug - it&#39;s just getting to a clean test environment. Here&#39;s how we spent hours fighting MPI libraries and chroot configurations before we could even start benchmarking.
    </div>
    <div class="post-meta"><span title='2025-11-08 11:00:00 +0000 +0000'>November 8, 2025</span>&nbsp;·&nbsp;<span>6 min</span>&nbsp;·&nbsp;<span>Brandon Geraci</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#the-simple-plan-that-wasnt-simple" aria-label="The Simple Plan (That Wasn&rsquo;t Simple)">The Simple Plan (That Wasn&rsquo;t Simple)</a></li>
                <li>
                    <a href="#attempt-1-just-run-it" aria-label="Attempt 1: Just Run It">Attempt 1: Just Run It</a></li>
                <li>
                    <a href="#extracting-the-container" aria-label="Extracting the Container">Extracting the Container</a></li>
                <li>
                    <a href="#the-mpi-library-hunt-begins" aria-label="The MPI Library Hunt Begins">The MPI Library Hunt Begins</a></li>
                <li>
                    <a href="#the-path-dance" aria-label="The PATH Dance">The PATH Dance</a></li>
                <li>
                    <a href="#the-ld_library_path-saga" aria-label="The LD_LIBRARY_PATH Saga">The LD_LIBRARY_PATH Saga</a></li>
                <li>
                    <a href="#the-real-problem" aria-label="The Real Problem">The Real Problem</a></li>
                <li>
                    <a href="#the-cuda-version-surprise" aria-label="The CUDA Version Surprise">The CUDA Version Surprise</a></li>
                <li>
                    <a href="#the-full-chroot-wrapper-script" aria-label="The Full Chroot Wrapper Script">The Full Chroot Wrapper Script</a></li>
                <li>
                    <a href="#lessons-learned" aria-label="Lessons Learned">Lessons Learned</a></li>
                <li>
                    <a href="#the-hard-part-is-over-right" aria-label="The Hard Part Is Over&hellip; Right?">The Hard Part Is Over&hellip; Right?</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="the-simple-plan-that-wasnt-simple">The Simple Plan (That Wasn&rsquo;t Simple)<a hidden class="anchor" aria-hidden="true" href="#the-simple-plan-that-wasnt-simple">#</a></h2>
<p>After seeing the mysterious 26GB memory overhead in Docker, my plan was straightforward:</p>
<ol>
<li>Extract the container&rsquo;s filesystem</li>
<li>Run the same Python scripts natively</li>
<li>Compare the results</li>
<li>Done!</li>
</ol>
<p>Ha. Hahahaha. <strong>No.</strong></p>
<h2 id="attempt-1-just-run-it">Attempt 1: Just Run It<a hidden class="anchor" aria-hidden="true" href="#attempt-1-just-run-it">#</a></h2>
<p>My first thought: &ldquo;Let&rsquo;s just run the Docker scripts on my system. How hard can it be?&rdquo;</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python /home/khan/benchmark-spark/benchmarks/trtllm_benchmark.py <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    --model deepseek-ai/DeepSeek-R1-Distill-Qwen-7B
</span></span></code></pre></td></tr></table>
</div>
</div><p>What I got: <strong>Runtime nightmare</strong>.</p>



<div class="goat svg-container ">
  
    <svg
      xmlns="http://www.w3.org/2000/svg"
      font-family="Menlo,Lucida Console,monospace"
      
        viewBox="0 0 464 57"
      >
      <g transform='translate(8,16)'>
<text text-anchor='middle' x='0' y='4' fill='currentColor' style='font-size:1em'>M</text>
<text text-anchor='middle' x='0' y='20' fill='currentColor' style='font-size:1em'>I</text>
<text text-anchor='middle' x='0' y='36' fill='currentColor' style='font-size:1em'>C</text>
<text text-anchor='middle' x='8' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='8' y='20' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='8' y='36' fill='currentColor' style='font-size:1em'>U</text>
<text text-anchor='middle' x='16' y='4' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='16' y='20' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='16' y='36' fill='currentColor' style='font-size:1em'>D</text>
<text text-anchor='middle' x='24' y='4' fill='currentColor' style='font-size:1em'>u</text>
<text text-anchor='middle' x='24' y='20' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='24' y='36' fill='currentColor' style='font-size:1em'>A</text>
<text text-anchor='middle' x='32' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='32' y='20' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='40' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='40' y='20' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='40' y='36' fill='currentColor' style='font-size:1em'>E</text>
<text text-anchor='middle' x='48' y='4' fill='currentColor' style='font-size:1em'>N</text>
<text text-anchor='middle' x='48' y='20' fill='currentColor' style='font-size:1em'>E</text>
<text text-anchor='middle' x='48' y='36' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='56' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='56' y='20' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='56' y='36' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='64' y='4' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='64' y='20' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='64' y='36' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='72' y='4' fill='currentColor' style='font-size:1em'>F</text>
<text text-anchor='middle' x='72' y='20' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='72' y='36' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='80' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='80' y='20' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='80' y='36' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='88' y='4' fill='currentColor' style='font-size:1em'>u</text>
<text text-anchor='middle' x='88' y='20' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='96' y='4' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='96' y='36' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='104' y='4' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='104' y='20' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='104' y='36' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='112' y='4' fill='currentColor' style='font-size:1em'>E</text>
<text text-anchor='middle' x='112' y='20' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='120' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='120' y='20' fill='currentColor' style='font-size:1em'>b</text>
<text text-anchor='middle' x='120' y='36' fill='currentColor' style='font-size:1em'>C</text>
<text text-anchor='middle' x='128' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='128' y='20' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='128' y='36' fill='currentColor' style='font-size:1em'>U</text>
<text text-anchor='middle' x='136' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='136' y='20' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='136' y='36' fill='currentColor' style='font-size:1em'>D</text>
<text text-anchor='middle' x='144' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='144' y='20' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='144' y='36' fill='currentColor' style='font-size:1em'>A</text>
<text text-anchor='middle' x='152' y='4' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='152' y='20' fill='currentColor' style='font-size:1em'>.</text>
<text text-anchor='middle' x='152' y='36' fill='currentColor' style='font-size:1em'>-</text>
<text text-anchor='middle' x='160' y='20' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='160' y='36' fill='currentColor' style='font-size:1em'>c</text>
<text text-anchor='middle' x='168' y='4' fill='currentColor' style='font-size:1em'>N</text>
<text text-anchor='middle' x='168' y='20' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='168' y='36' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='176' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='176' y='20' fill='currentColor' style='font-size:1em'>.</text>
<text text-anchor='middle' x='176' y='36' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='184' y='20' fill='currentColor' style='font-size:1em'>4</text>
<text text-anchor='middle' x='184' y='36' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='192' y='4' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='192' y='20' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='192' y='36' fill='currentColor' style='font-size:1em'>b</text>
<text text-anchor='middle' x='200' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='200' y='20' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='200' y='36' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='208' y='4' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='208' y='36' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='216' y='4' fill='currentColor' style='font-size:1em'>u</text>
<text text-anchor='middle' x='216' y='20' fill='currentColor' style='font-size:1em'>c</text>
<text text-anchor='middle' x='224' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='224' y='20' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='224' y='36' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='232' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='232' y='20' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='232' y='36' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='240' y='20' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='240' y='36' fill='currentColor' style='font-size:1em'>v</text>
<text text-anchor='middle' x='248' y='4' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='248' y='20' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='248' y='36' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='256' y='4' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='256' y='20' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='256' y='36' fill='currentColor' style='font-size:1em'>c</text>
<text text-anchor='middle' x='264' y='4' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='264' y='36' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='272' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='272' y='20' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='280' y='4' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='280' y='20' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='280' y='36' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='288' y='20' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='288' y='36' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='296' y='4' fill='currentColor' style='font-size:1em'>'</text>
<text text-anchor='middle' x='296' y='20' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='304' y='4' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='304' y='36' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='312' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='312' y='20' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='312' y='36' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='320' y='4' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='320' y='20' fill='currentColor' style='font-size:1em'>h</text>
<text text-anchor='middle' x='320' y='36' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='328' y='4' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='328' y='20' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='328' y='36' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='336' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='336' y='20' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='336' y='36' fill='currentColor' style='font-size:1em'>c</text>
<text text-anchor='middle' x='344' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='344' y='20' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='344' y='36' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='352' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='352' y='20' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='352' y='36' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='360' y='4' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='360' y='36' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='368' y='4' fill='currentColor' style='font-size:1em'>_</text>
<text text-anchor='middle' x='368' y='20' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='376' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='376' y='20' fill='currentColor' style='font-size:1em'>b</text>
<text text-anchor='middle' x='384' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='384' y='20' fill='currentColor' style='font-size:1em'>j</text>
<text text-anchor='middle' x='392' y='4' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='392' y='20' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='400' y='4' fill='currentColor' style='font-size:1em'>'</text>
<text text-anchor='middle' x='400' y='20' fill='currentColor' style='font-size:1em'>c</text>
<text text-anchor='middle' x='408' y='20' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='424' y='20' fill='currentColor' style='font-size:1em'>f</text>
<text text-anchor='middle' x='432' y='20' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='440' y='20' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='448' y='20' fill='currentColor' style='font-size:1em'>e</text>
</g>

    </svg>
  
</div>
<p>Of course. The container has TensorRT-LLM, specific CUDA versions, MPI libraries, and about a million other dependencies that my host system doesn&rsquo;t have (or has different versions of).</p>
<p>Okay, fine. Let&rsquo;s extract the container and use chroot.</p>
<h2 id="extracting-the-container">Extracting the Container<a hidden class="anchor" aria-hidden="true" href="#extracting-the-container">#</a></h2>
<p>Docker containers are just fancy tarballs with layers. To extract:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Export the container filesystem</span>
</span></span><span style="display:flex;"><span>docker create --name temp nvcr.io/nvidia/tensorrt-llm/release:spark-single-gpu-dev
</span></span><span style="display:flex;"><span>docker export temp &gt; container.tar
</span></span><span style="display:flex;"><span>docker rm temp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Extract to a directory</span>
</span></span><span style="display:flex;"><span>mkdir -p /home/khan/container-rootfs
</span></span><span style="display:flex;"><span>sudo tar -xf container.tar -C /home/khan/container-rootfs
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now I have the entire container filesystem at <code>/home/khan/container-rootfs/</code>. Cool!</p>
<h2 id="the-mpi-library-hunt-begins">The MPI Library Hunt Begins<a hidden class="anchor" aria-hidden="true" href="#the-mpi-library-hunt-begins">#</a></h2>
<p>Time to run something:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo chroot /home/khan/container-rootfs python3 /workspace/benchmarks/trtllm_benchmark.py
</span></span></code></pre></td></tr></table>
</div>
</div><p>New error:</p>



<div class="goat svg-container ">
  
    <svg
      xmlns="http://www.w3.org/2000/svg"
      font-family="Menlo,Lucida Console,monospace"
      
        viewBox="0 0 384 41"
      >
      <g transform='translate(8,16)'>
<text text-anchor='middle' x='0' y='4' fill='currentColor' style='font-size:1em'>[</text>
<text text-anchor='middle' x='0' y='20' fill='currentColor' style='font-size:1em'>M</text>
<text text-anchor='middle' x='8' y='4' fill='currentColor' style='font-size:1em'>T</text>
<text text-anchor='middle' x='8' y='20' fill='currentColor' style='font-size:1em'>P</text>
<text text-anchor='middle' x='16' y='4' fill='currentColor' style='font-size:1em'>R</text>
<text text-anchor='middle' x='16' y='20' fill='currentColor' style='font-size:1em'>I</text>
<text text-anchor='middle' x='24' y='4' fill='currentColor' style='font-size:1em'>T</text>
<text text-anchor='middle' x='32' y='4' fill='currentColor' style='font-size:1em'>-</text>
<text text-anchor='middle' x='32' y='20' fill='currentColor' style='font-size:1em'>E</text>
<text text-anchor='middle' x='40' y='4' fill='currentColor' style='font-size:1em'>L</text>
<text text-anchor='middle' x='40' y='20' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='48' y='4' fill='currentColor' style='font-size:1em'>L</text>
<text text-anchor='middle' x='48' y='20' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='56' y='4' fill='currentColor' style='font-size:1em'>M</text>
<text text-anchor='middle' x='56' y='20' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='64' y='4' fill='currentColor' style='font-size:1em'>]</text>
<text text-anchor='middle' x='64' y='20' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='72' y='20' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='80' y='4' fill='currentColor' style='font-size:1em'>[</text>
<text text-anchor='middle' x='88' y='4' fill='currentColor' style='font-size:1em'>I</text>
<text text-anchor='middle' x='88' y='20' fill='currentColor' style='font-size:1em'>u</text>
<text text-anchor='middle' x='96' y='4' fill='currentColor' style='font-size:1em'>]</text>
<text text-anchor='middle' x='96' y='20' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='104' y='20' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='112' y='4' fill='currentColor' style='font-size:1em'>M</text>
<text text-anchor='middle' x='112' y='20' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='120' y='4' fill='currentColor' style='font-size:1em'>P</text>
<text text-anchor='middle' x='120' y='20' fill='currentColor' style='font-size:1em'>f</text>
<text text-anchor='middle' x='128' y='4' fill='currentColor' style='font-size:1em'>I</text>
<text text-anchor='middle' x='128' y='20' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='136' y='20' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='144' y='4' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='144' y='20' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='152' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='152' y='20' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='160' y='4' fill='currentColor' style='font-size:1em'>z</text>
<text text-anchor='middle' x='168' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='168' y='20' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='176' y='4' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='176' y='20' fill='currentColor' style='font-size:1em'>y</text>
<text text-anchor='middle' x='184' y='20' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='192' y='4' fill='currentColor' style='font-size:1em'>1</text>
<text text-anchor='middle' x='192' y='20' fill='currentColor' style='font-size:1em'>b</text>
<text text-anchor='middle' x='200' y='4' fill='currentColor' style='font-size:1em'>,</text>
<text text-anchor='middle' x='200' y='20' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='208' y='20' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='216' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='216' y='20' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='224' y='4' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='232' y='4' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='232' y='20' fill='currentColor' style='font-size:1em'>u</text>
<text text-anchor='middle' x='240' y='4' fill='currentColor' style='font-size:1em'>k</text>
<text text-anchor='middle' x='240' y='20' fill='currentColor' style='font-size:1em'>c</text>
<text text-anchor='middle' x='248' y='4' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='248' y='20' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='256' y='20' fill='currentColor' style='font-size:1em'>_</text>
<text text-anchor='middle' x='264' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='264' y='20' fill='currentColor' style='font-size:1em'>c</text>
<text text-anchor='middle' x='272' y='20' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='280' y='20' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='288' y='20' fill='currentColor' style='font-size:1em'>f</text>
<text text-anchor='middle' x='296' y='20' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='304' y='20' fill='currentColor' style='font-size:1em'>g</text>
<text text-anchor='middle' x='312' y='20' fill='currentColor' style='font-size:1em'>_</text>
<text text-anchor='middle' x='320' y='20' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='328' y='20' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='336' y='20' fill='currentColor' style='font-size:1em'>c</text>
<text text-anchor='middle' x='344' y='20' fill='currentColor' style='font-size:1em'>_</text>
<text text-anchor='middle' x='352' y='20' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='360' y='20' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='368' y='20' fill='currentColor' style='font-size:1em'>p</text>
</g>

    </svg>
  
</div>
<p>What? Let me check which MPI it&rsquo;s using:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>which mpirun
</span></span><span style="display:flex;"><span><span style="color:#75715e"># /usr/bin/mpirun  ← System MPI!</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ah. The chroot is finding the <strong>system&rsquo;s MPI</strong> (installed at <code>/usr/bin/mpirun</code>) instead of the <strong>container&rsquo;s MPI</strong> (at <code>/opt/hpcx/ompi/bin/mpirun</code> inside the rootfs).</p>
<h2 id="the-path-dance">The PATH Dance<a hidden class="anchor" aria-hidden="true" href="#the-path-dance">#</a></h2>
<p>TensorRT-LLM uses HPC-X OpenMPI from NVIDIA. The container has it at <code>/opt/hpcx/ompi/</code>. But when I chroot, the PATH still points to system binaries first.</p>
<p>Solution: Explicitly set PATH to prioritize container binaries.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/opt/hpcx/ompi/bin:</span>$PATH<span style="color:#e6db74">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Run again&hellip; new error:</p>



<div class="goat svg-container ">
  
    <svg
      xmlns="http://www.w3.org/2000/svg"
      font-family="Menlo,Lucida Console,monospace"
      
        viewBox="0 0 720 25"
      >
      <g transform='translate(8,16)'>
<text text-anchor='middle' x='0' y='4' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='8' y='4' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='16' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='24' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='32' y='4' fill='currentColor' style='font-size:1em'>u</text>
<text text-anchor='middle' x='40' y='4' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='48' y='4' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='64' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='72' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='80' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='88' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='96' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='112' y='4' fill='currentColor' style='font-size:1em'>w</text>
<text text-anchor='middle' x='120' y='4' fill='currentColor' style='font-size:1em'>h</text>
<text text-anchor='middle' x='128' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='136' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='144' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='160' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='168' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='176' y='4' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='184' y='4' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='192' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='200' y='4' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='208' y='4' fill='currentColor' style='font-size:1em'>g</text>
<text text-anchor='middle' x='224' y='4' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='232' y='4' fill='currentColor' style='font-size:1em'>h</text>
<text text-anchor='middle' x='240' y='4' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='248' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='256' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='264' y='4' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='280' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='288' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='296' y='4' fill='currentColor' style='font-size:1em'>b</text>
<text text-anchor='middle' x='304' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='312' y='4' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='320' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='328' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='336' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='344' y='4' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='352' y='4' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='368' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='376' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='384' y='4' fill='currentColor' style='font-size:1em'>b</text>
<text text-anchor='middle' x='392' y='4' fill='currentColor' style='font-size:1em'>u</text>
<text text-anchor='middle' x='400' y='4' fill='currentColor' style='font-size:1em'>c</text>
<text text-anchor='middle' x='408' y='4' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='416' y='4' fill='currentColor' style='font-size:1em'>.</text>
<text text-anchor='middle' x='424' y='4' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='432' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='440' y='4' fill='currentColor' style='font-size:1em'>.</text>
<text text-anchor='middle' x='448' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='456' y='4' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='472' y='4' fill='currentColor' style='font-size:1em'>c</text>
<text text-anchor='middle' x='480' y='4' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='488' y='4' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='496' y='4' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='504' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='512' y='4' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='528' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='536' y='4' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='544' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='552' y='4' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='568' y='4' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='576' y='4' fill='currentColor' style='font-size:1em'>h</text>
<text text-anchor='middle' x='584' y='4' fill='currentColor' style='font-size:1em'>a</text>
<text text-anchor='middle' x='592' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='600' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='608' y='4' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='624' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='632' y='4' fill='currentColor' style='font-size:1em'>b</text>
<text text-anchor='middle' x='640' y='4' fill='currentColor' style='font-size:1em'>j</text>
<text text-anchor='middle' x='648' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='656' y='4' fill='currentColor' style='font-size:1em'>c</text>
<text text-anchor='middle' x='664' y='4' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='680' y='4' fill='currentColor' style='font-size:1em'>f</text>
<text text-anchor='middle' x='688' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='696' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='704' y='4' fill='currentColor' style='font-size:1em'>e</text>
</g>

    </svg>
  
</div>
<p>The MPI binary is now correct, but it can&rsquo;t find its libraries!</p>
<h2 id="the-ld_library_path-saga">The LD_LIBRARY_PATH Saga<a hidden class="anchor" aria-hidden="true" href="#the-ld_library_path-saga">#</a></h2>
<p>The container&rsquo;s MPI needs libraries from <code>/opt/hpcx/ompi/lib/</code>, but <code>LD_LIBRARY_PATH</code> doesn&rsquo;t include it.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export LD_LIBRARY_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/opt/hpcx/ompi/lib:</span>$LD_LIBRARY_PATH<span style="color:#e6db74">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Run again&hellip; <strong>DIFFERENT</strong> error:</p>



<div class="goat svg-container ">
  
    <svg
      xmlns="http://www.w3.org/2000/svg"
      font-family="Menlo,Lucida Console,monospace"
      
        viewBox="0 0 728 25"
      >
      <g transform='translate(8,16)'>
<path d='M 164,8 L 164,24' fill='none' stroke='currentColor'></path>
<text text-anchor='middle' x='0' y='4' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='8' y='4' fill='currentColor' style='font-size:1em'>y</text>
<text text-anchor='middle' x='16' y='4' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='24' y='4' fill='currentColor' style='font-size:1em'>b</text>
<text text-anchor='middle' x='32' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='40' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='56' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='64' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='72' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='80' y='4' fill='currentColor' style='font-size:1em'>k</text>
<text text-anchor='middle' x='88' y='4' fill='currentColor' style='font-size:1em'>u</text>
<text text-anchor='middle' x='96' y='4' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='112' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='120' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='128' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='136' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='144' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='152' y='4' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='176' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='184' y='4' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='192' y='4' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='200' y='4' fill='currentColor' style='font-size:1em'>/</text>
<text text-anchor='middle' x='208' y='4' fill='currentColor' style='font-size:1em'>h</text>
<text text-anchor='middle' x='216' y='4' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='224' y='4' fill='currentColor' style='font-size:1em'>c</text>
<text text-anchor='middle' x='232' y='4' fill='currentColor' style='font-size:1em'>x</text>
<text text-anchor='middle' x='240' y='4' fill='currentColor' style='font-size:1em'>/</text>
<text text-anchor='middle' x='248' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='256' y='4' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='264' y='4' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='272' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='280' y='4' fill='currentColor' style='font-size:1em'>/</text>
<text text-anchor='middle' x='288' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='296' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='304' y='4' fill='currentColor' style='font-size:1em'>b</text>
<text text-anchor='middle' x='312' y='4' fill='currentColor' style='font-size:1em'>/</text>
<text text-anchor='middle' x='320' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='328' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='336' y='4' fill='currentColor' style='font-size:1em'>b</text>
<text text-anchor='middle' x='344' y='4' fill='currentColor' style='font-size:1em'>u</text>
<text text-anchor='middle' x='352' y='4' fill='currentColor' style='font-size:1em'>c</text>
<text text-anchor='middle' x='360' y='4' fill='currentColor' style='font-size:1em'>c</text>
<text text-anchor='middle' x='368' y='4' fill='currentColor' style='font-size:1em'>.</text>
<text text-anchor='middle' x='376' y='4' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='384' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='392' y='4' fill='currentColor' style='font-size:1em'>.</text>
<text text-anchor='middle' x='400' y='4' fill='currentColor' style='font-size:1em'>1</text>
<text text-anchor='middle' x='408' y='4' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='424' y='4' fill='currentColor' style='font-size:1em'>u</text>
<text text-anchor='middle' x='432' y='4' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='440' y='4' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='448' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='456' y='4' fill='currentColor' style='font-size:1em'>f</text>
<text text-anchor='middle' x='464' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='472' y='4' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='480' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='488' y='4' fill='currentColor' style='font-size:1em'>d</text>
<text text-anchor='middle' x='504' y='4' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='512' y='4' fill='currentColor' style='font-size:1em'>y</text>
<text text-anchor='middle' x='520' y='4' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='528' y='4' fill='currentColor' style='font-size:1em'>b</text>
<text text-anchor='middle' x='536' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='544' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='552' y='4' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='568' y='4' fill='currentColor' style='font-size:1em'>u</text>
<text text-anchor='middle' x='576' y='4' fill='currentColor' style='font-size:1em'>c</text>
<text text-anchor='middle' x='584' y='4' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='592' y='4' fill='currentColor' style='font-size:1em'>_</text>
<text text-anchor='middle' x='600' y='4' fill='currentColor' style='font-size:1em'>w</text>
<text text-anchor='middle' x='608' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='616' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='624' y='4' fill='currentColor' style='font-size:1em'>k</text>
<text text-anchor='middle' x='632' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='640' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='648' y='4' fill='currentColor' style='font-size:1em'>_</text>
<text text-anchor='middle' x='656' y='4' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='664' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='672' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='680' y='4' fill='currentColor' style='font-size:1em'>g</text>
<text text-anchor='middle' x='688' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='696' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='704' y='4' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='712' y='4' fill='currentColor' style='font-size:1em'>s</text>
</g>

    </svg>
  
</div>
<p>Wait, what? Now it&rsquo;s finding the HPC-X libraries but they&rsquo;re conflicting with system libraries!</p>
<h2 id="the-real-problem">The Real Problem<a hidden class="anchor" aria-hidden="true" href="#the-real-problem">#</a></h2>
<p>Here&rsquo;s what was happening:</p>
<ol>
<li>The <strong>system</strong> has OpenMPI installed (<code>libmpi.so</code>)</li>
<li>The <strong>container</strong> has HPC-X OpenMPI (<code>/opt/hpcx/ompi/lib/libmpi.so</code>)</li>
<li>TensorRT-LLM needs the HPC-X version</li>
<li>But the dynamic linker was mixing system and container libraries</li>
</ol>
<p>The fix: <strong>Put container libraries at the FRONT</strong> of <code>LD_LIBRARY_PATH</code>:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export LD_LIBRARY_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/opt/hpcx/ompi/lib:/usr/local/lib/python3.12/dist-packages/tensorrt_libs:</span>$LD_LIBRARY_PATH<span style="color:#e6db74">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Finally, MPI works!</p>
<h2 id="the-cuda-version-surprise">The CUDA Version Surprise<a hidden class="anchor" aria-hidden="true" href="#the-cuda-version-surprise">#</a></h2>
<p>Got MPI working. Started a benchmark. New error:</p>



<div class="goat svg-container ">
  
    <svg
      xmlns="http://www.w3.org/2000/svg"
      font-family="Menlo,Lucida Console,monospace"
      
        viewBox="0 0 664 25"
      >
      <g transform='translate(8,16)'>
<text text-anchor='middle' x='0' y='4' fill='currentColor' style='font-size:1em'>R</text>
<text text-anchor='middle' x='8' y='4' fill='currentColor' style='font-size:1em'>u</text>
<text text-anchor='middle' x='16' y='4' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='24' y='4' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='32' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='40' y='4' fill='currentColor' style='font-size:1em'>m</text>
<text text-anchor='middle' x='48' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='56' y='4' fill='currentColor' style='font-size:1em'>E</text>
<text text-anchor='middle' x='64' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='72' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='80' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='88' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='96' y='4' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='112' y='4' fill='currentColor' style='font-size:1em'>T</text>
<text text-anchor='middle' x='120' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='128' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='136' y='4' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='144' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='152' y='4' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='168' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='176' y='4' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='184' y='4' fill='currentColor' style='font-size:1em'>l</text>
<text text-anchor='middle' x='192' y='4' fill='currentColor' style='font-size:1em'>y</text>
<text text-anchor='middle' x='208' y='4' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='216' y='4' fill='currentColor' style='font-size:1em'>u</text>
<text text-anchor='middle' x='224' y='4' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='232' y='4' fill='currentColor' style='font-size:1em'>p</text>
<text text-anchor='middle' x='240' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='248' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='256' y='4' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='264' y='4' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='280' y='4' fill='currentColor' style='font-size:1em'>C</text>
<text text-anchor='middle' x='288' y='4' fill='currentColor' style='font-size:1em'>U</text>
<text text-anchor='middle' x='296' y='4' fill='currentColor' style='font-size:1em'>D</text>
<text text-anchor='middle' x='304' y='4' fill='currentColor' style='font-size:1em'>A</text>
<text text-anchor='middle' x='320' y='4' fill='currentColor' style='font-size:1em'>1</text>
<text text-anchor='middle' x='328' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='336' y='4' fill='currentColor' style='font-size:1em'>.</text>
<text text-anchor='middle' x='344' y='4' fill='currentColor' style='font-size:1em'>0</text>
<text text-anchor='middle' x='360' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='368' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='384' y='4' fill='currentColor' style='font-size:1em'>h</text>
<text text-anchor='middle' x='392' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='400' y='4' fill='currentColor' style='font-size:1em'>g</text>
<text text-anchor='middle' x='408' y='4' fill='currentColor' style='font-size:1em'>h</text>
<text text-anchor='middle' x='416' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='424' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='432' y='4' fill='currentColor' style='font-size:1em'>,</text>
<text text-anchor='middle' x='448' y='4' fill='currentColor' style='font-size:1em'>b</text>
<text text-anchor='middle' x='456' y='4' fill='currentColor' style='font-size:1em'>u</text>
<text text-anchor='middle' x='464' y='4' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='480' y='4' fill='currentColor' style='font-size:1em'>g</text>
<text text-anchor='middle' x='488' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='496' y='4' fill='currentColor' style='font-size:1em'>t</text>
<text text-anchor='middle' x='512' y='4' fill='currentColor' style='font-size:1em'>C</text>
<text text-anchor='middle' x='520' y='4' fill='currentColor' style='font-size:1em'>U</text>
<text text-anchor='middle' x='528' y='4' fill='currentColor' style='font-size:1em'>D</text>
<text text-anchor='middle' x='536' y='4' fill='currentColor' style='font-size:1em'>A</text>
<text text-anchor='middle' x='552' y='4' fill='currentColor' style='font-size:1em'>v</text>
<text text-anchor='middle' x='560' y='4' fill='currentColor' style='font-size:1em'>e</text>
<text text-anchor='middle' x='568' y='4' fill='currentColor' style='font-size:1em'>r</text>
<text text-anchor='middle' x='576' y='4' fill='currentColor' style='font-size:1em'>s</text>
<text text-anchor='middle' x='584' y='4' fill='currentColor' style='font-size:1em'>i</text>
<text text-anchor='middle' x='592' y='4' fill='currentColor' style='font-size:1em'>o</text>
<text text-anchor='middle' x='600' y='4' fill='currentColor' style='font-size:1em'>n</text>
<text text-anchor='middle' x='608' y='4' fill='currentColor' style='font-size:1em'>:</text>
<text text-anchor='middle' x='624' y='4' fill='currentColor' style='font-size:1em'>1</text>
<text text-anchor='middle' x='632' y='4' fill='currentColor' style='font-size:1em'>3</text>
<text text-anchor='middle' x='640' y='4' fill='currentColor' style='font-size:1em'>.</text>
<text text-anchor='middle' x='648' y='4' fill='currentColor' style='font-size:1em'>0</text>
</g>

    </svg>
  
</div>
<p>Wait, CUDA 13.0? We&rsquo;re using CUDA 12.9!</p>
<p>Turns out: The system symlink <code>/usr/local/cuda</code> pointed to CUDA 13.0. The container needs CUDA 12.9.</p>
<p>Fix:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export CUDA_HOME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/local/cuda-12.9&#34;</span>
</span></span><span style="display:flex;"><span>export PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/local/cuda-12.9/bin:</span>$PATH<span style="color:#e6db74">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="the-full-chroot-wrapper-script">The Full Chroot Wrapper Script<a hidden class="anchor" aria-hidden="true" href="#the-full-chroot-wrapper-script">#</a></h2>
<p>After all this pain, I created a proper chroot wrapper that handles everything:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>SCRIPT_DIR<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/home/khan/container-rootfs&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Mount necessary filesystems</span>
</span></span><span style="display:flex;"><span>sudo mount -t proc /proc <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SCRIPT_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/proc&#34;</span>
</span></span><span style="display:flex;"><span>sudo mount --rbind /sys <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SCRIPT_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/sys&#34;</span>
</span></span><span style="display:flex;"><span>sudo mount --rbind /dev <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SCRIPT_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/dev&#34;</span>
</span></span><span style="display:flex;"><span>sudo mount --bind /home <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SCRIPT_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/home&#34;</span>
</span></span><span style="display:flex;"><span>sudo mount --bind /data <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SCRIPT_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/data&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># DNS resolution</span>
</span></span><span style="display:flex;"><span>sudo cp /etc/resolv.conf <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SCRIPT_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/etc/resolv.conf&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Run in chroot with proper environment</span>
</span></span><span style="display:flex;"><span>sudo chroot <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SCRIPT_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span> /usr/bin/env -i <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    HOME<span style="color:#f92672">=</span>/root <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/opt/hpcx/ompi/bin:/usr/local/cuda-12.9/bin:/usr/local/bin:/usr/bin:/bin&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    LD_LIBRARY_PATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/opt/hpcx/ompi/lib:/usr/local/lib/python3.12/dist-packages/tensorrt_libs:/usr/local/cuda-12.9/lib64&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    CUDA_HOME<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/local/cuda-12.9&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    PYTHONPATH<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/usr/local/lib/python3.12/dist-packages&#34;</span> <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>    <span style="color:#e6db74">&#34;</span>$@<span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Cleanup: unmount everything</span>
</span></span><span style="display:flex;"><span>sudo umount <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SCRIPT_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/data&#34;</span>
</span></span><span style="display:flex;"><span>sudo umount <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SCRIPT_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/home&#34;</span>
</span></span><span style="display:flex;"><span>sudo umount <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SCRIPT_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/dev&#34;</span>
</span></span><span style="display:flex;"><span>sudo umount <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SCRIPT_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/sys&#34;</span>
</span></span><span style="display:flex;"><span>sudo umount <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>SCRIPT_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">/proc&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now I can run:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./run_in_rootfs.sh python3 /home/khan/benchmark-spark/benchmarks/trtllm_benchmark.py
</span></span></code></pre></td></tr></table>
</div>
</div><p>And it <strong>actually works</strong>.</p>
<h2 id="lessons-learned">Lessons Learned<a hidden class="anchor" aria-hidden="true" href="#lessons-learned">#</a></h2>
<ol>
<li><strong>Library paths matter</strong>: System vs container libraries will bite you</li>
<li><strong>Environment is everything</strong>: PATH, LD_LIBRARY_PATH, CUDA_HOME all critical</li>
<li><strong>MPI is picky</strong>: HPC-X OpenMPI isn&rsquo;t interchangeable with system OpenMPI</li>
<li><strong>Filesystem mounts</strong>: Need /proc, /sys, /dev, /home, and /data bind mounts</li>
<li><strong>DNS matters</strong>: Even forgot <code>/etc/resolv.conf</code> initially!</li>
</ol>
<h2 id="the-hard-part-is-over-right">The Hard Part Is Over&hellip; Right?<a hidden class="anchor" aria-hidden="true" href="#the-hard-part-is-over-right">#</a></h2>
<p>With a working chroot environment, I could finally start benchmarking. But getting here took <strong>hours</strong> of debugging library paths and runtime errors.</p>
<p>Sometimes I wonder if this is why people just accept Docker&rsquo;s overhead - at least it works out of the box!</p>
<p>But now that we have both Docker and native environments working, we can actually compare them fairly. And that&rsquo;s where things get interesting&hellip;</p>
<p>In the next post: What Grace Hopper&rsquo;s unified memory architecture actually means, and why Docker&rsquo;s cgroups don&rsquo;t understand it.</p>
<hr>
<p><strong>Previous</strong>: <a href="../01-the-mystery">← Part 1: The Mystery</a><br>
<strong>Next</strong>: <a href="../03-unified-memory-revelation">Part 3: The Unified Memory Revelation →</a></p>
<p><strong>GitHub Repo</strong>: <a href="https://github.com/brandonrc/benchmark-spark">benchmark-spark</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://brandonrc.github.io/dgx-spark-blog/tags/dgx-spark/">Dgx-Spark</a></li>
      <li><a href="https://brandonrc.github.io/dgx-spark-blog/tags/mpi/">Mpi</a></li>
      <li><a href="https://brandonrc.github.io/dgx-spark-blog/tags/chroot/">Chroot</a></li>
      <li><a href="https://brandonrc.github.io/dgx-spark-blog/tags/debugging/">Debugging</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://brandonrc.github.io/dgx-spark-blog/posts/03-unified-memory-revelation/">
    <span class="title">« Prev</span>
    <br>
    <span>The Unified Memory Revelation: Why Docker Double-Counts</span>
  </a>
  <a class="next" href="https://brandonrc.github.io/dgx-spark-blog/posts/01-the-mystery/">
    <span class="title">Next »</span>
    <br>
    <span>The Mystery: Don&#39;t Just Blame the Hardware</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Down the Rabbit Hole: The MPI and Chroot Nightmare on x"
            href="https://x.com/intent/tweet/?text=Down%20the%20Rabbit%20Hole%3a%20The%20MPI%20and%20Chroot%20Nightmare&amp;url=https%3a%2f%2fbrandonrc.github.io%2fdgx-spark-blog%2fposts%2f02-mpi-chroot-nightmare%2f&amp;hashtags=dgx-spark%2cmpi%2cchroot%2cdebugging">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Down the Rabbit Hole: The MPI and Chroot Nightmare on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fbrandonrc.github.io%2fdgx-spark-blog%2fposts%2f02-mpi-chroot-nightmare%2f&amp;title=Down%20the%20Rabbit%20Hole%3a%20The%20MPI%20and%20Chroot%20Nightmare&amp;summary=Down%20the%20Rabbit%20Hole%3a%20The%20MPI%20and%20Chroot%20Nightmare&amp;source=https%3a%2f%2fbrandonrc.github.io%2fdgx-spark-blog%2fposts%2f02-mpi-chroot-nightmare%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Down the Rabbit Hole: The MPI and Chroot Nightmare on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2fbrandonrc.github.io%2fdgx-spark-blog%2fposts%2f02-mpi-chroot-nightmare%2f&title=Down%20the%20Rabbit%20Hole%3a%20The%20MPI%20and%20Chroot%20Nightmare">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Down the Rabbit Hole: The MPI and Chroot Nightmare on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fbrandonrc.github.io%2fdgx-spark-blog%2fposts%2f02-mpi-chroot-nightmare%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Down the Rabbit Hole: The MPI and Chroot Nightmare on whatsapp"
            href="https://api.whatsapp.com/send?text=Down%20the%20Rabbit%20Hole%3a%20The%20MPI%20and%20Chroot%20Nightmare%20-%20https%3a%2f%2fbrandonrc.github.io%2fdgx-spark-blog%2fposts%2f02-mpi-chroot-nightmare%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Down the Rabbit Hole: The MPI and Chroot Nightmare on telegram"
            href="https://telegram.me/share/url?text=Down%20the%20Rabbit%20Hole%3a%20The%20MPI%20and%20Chroot%20Nightmare&amp;url=https%3a%2f%2fbrandonrc.github.io%2fdgx-spark-blog%2fposts%2f02-mpi-chroot-nightmare%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Down the Rabbit Hole: The MPI and Chroot Nightmare on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Down%20the%20Rabbit%20Hole%3a%20The%20MPI%20and%20Chroot%20Nightmare&u=https%3a%2f%2fbrandonrc.github.io%2fdgx-spark-blog%2fposts%2f02-mpi-chroot-nightmare%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://brandonrc.github.io/dgx-spark-blog/">DGX Spark Deep Dive</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
