<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head>
	<meta name="generator" content="Hugo 0.146.1"><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>DGX Spark Deep Dive</title>

<meta name="description" content="A technical journey debugging container performance on NVIDIA DGX Spark with Grace Blackwell">
<meta name="author" content="Brandon Geraci">
<link rel="canonical" href="https://brandonrc.github.io/dgx-spark-blog/">
<link crossorigin="anonymous" href="/dgx-spark-blog/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css" integrity="sha256-NDzEgLn/yPBMy&#43;XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://brandonrc.github.io/dgx-spark-blog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://brandonrc.github.io/dgx-spark-blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://brandonrc.github.io/dgx-spark-blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://brandonrc.github.io/dgx-spark-blog/apple-touch-icon.png">
<link rel="mask-icon" href="https://brandonrc.github.io/dgx-spark-blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="https://brandonrc.github.io/dgx-spark-blog/index.xml" title="rss">
<link rel="alternate" type="application/json" href="https://brandonrc.github.io/dgx-spark-blog/index.json" title="json">
<link rel="alternate" hreflang="en" href="https://brandonrc.github.io/dgx-spark-blog/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="https://brandonrc.github.io/dgx-spark-blog/">
  <meta property="og:site_name" content="DGX Spark Deep Dive">
  <meta property="og:title" content="DGX Spark Deep Dive">
  <meta property="og:description" content="A technical journey debugging container performance on NVIDIA DGX Spark with Grace Blackwell">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DGX Spark Deep Dive">
<meta name="twitter:description" content="A technical journey debugging container performance on NVIDIA DGX Spark with Grace Blackwell">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "DGX Spark Deep Dive",
  "url": "https://brandonrc.github.io/dgx-spark-blog/",
  "description": "A technical journey debugging container performance on NVIDIA DGX Spark with Grace Blackwell",
  "logo": "https://brandonrc.github.io/dgx-spark-blog/favicon.ico",
  "sameAs": [
      "https://github.com/brandonrc/benchmark-spark"
  ]
}
</script>
</head>
<body class="list" id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://brandonrc.github.io/dgx-spark-blog/" accesskey="h" title="DGX Spark Deep Dive (Alt + H)">DGX Spark Deep Dive</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://brandonrc.github.io/dgx-spark-blog/posts/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://brandonrc.github.io/dgx-spark-blog/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://github.com/brandonrc/benchmark-spark" title="Results">
                    <span>Results</span>&nbsp;
                    <svg fill="none" shape-rendering="geometricPrecision" stroke="currentColor" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path>
                        <path d="M15 3h6v6"></path>
                        <path d="M10 14L21 3"></path>
                    </svg>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<article class="first-entry home-info">
    <header class="entry-header">
        <h1>DGX Spark Performance Investigation</h1>
    </header>
    <div class="entry-content">
        <pre><code>A deep dive into debugging why Docker containers were using 20-30 GB more memory than native execution on NVIDIA DGX Spark.

**Spoiler**: Grace Blackwell's unified memory architecture + Docker's cgroups = double-counting.
</code></pre>

    </div>
    <footer class="entry-footer">
        <div class="social-icons" >
    <a href="https://github.com/brandonrc/benchmark-spark" target="_blank" rel="noopener noreferrer me"
        title="Github">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
    </a>
</div>

    </footer>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">KV Cache Deep Dive: The 2x Reduction Mystery
    </h2>
  </header>
  <div class="entry-content">
    <p>The Pattern That Demands Explanation In Part 4, I showed you 60 benchmark runs that revealed a consistent pattern. But one table in particular kept me up at night:
Model Native KV Container KV Reduction Factor DeepSeek-7B 44.31 GiB 16.57 GiB 2.7x less GPT-OSS-120B 43.19 GiB 23.65 GiB 1.8x less Qwen2.5-72B 44.71 GiB 26.72 GiB 1.7x less Two questions immediately jump out:
Why do containers consistently allocate ~2x less KV cache? (The main mystery) Why do all native runs converge to ~44 GiB? (The secondary puzzle) Let’s answer both.
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-11-08 15:00:00 +0000 +0000'>November 8, 2025</span>&nbsp;·&nbsp;<span>18 min</span>&nbsp;·&nbsp;<span>Brandon Geraci</span></footer>
  <a class="entry-link" aria-label="post link to KV Cache Deep Dive: The 2x Reduction Mystery" href="https://brandonrc.github.io/dgx-spark-blog/posts/06-kv-cache-deep-dive/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">What I Learned (And What&#39;s Next)
    </h2>
  </header>
  <div class="entry-content">
    <p>The Journey So Far Let’s recap this wild ride:
The Problem: YouTube reviewers blamed NVIDIA hardware for being slow The Investigation: I found 20-30GB memory overhead in Docker containers The Environment Setup: MPI and chroot configuration nightmare The Revelation: Docker’s cgroups double-count unified memory The Data: 60 runs confirmed the pattern consistently Now, what do I actually do with this knowledge?
Key Finding: Don’t Blame the Hardware The most important lesson from this entire investigation:
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-11-08 14:00:00 +0000 +0000'>November 8, 2025</span>&nbsp;·&nbsp;<span>5 min</span>&nbsp;·&nbsp;<span>Brandon Geraci</span></footer>
  <a class="entry-link" aria-label="post link to What I Learned (And What&#39;s Next)" href="https://brandonrc.github.io/dgx-spark-blog/posts/05-what-we-learned/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">The Data: 60 Runs Don&#39;t Lie
    </h2>
  </header>
  <div class="entry-content">
    <p>The Comprehensive Test Plan Anecdotes are interesting. Single data points are suggestive. But 60 benchmark runs across multiple models? That’s science.
Here’s what I did:
Test Matrix 3 Models: DeepSeek-R1-Distill-Qwen-7B (7 billion parameters) Qwen2.5-72B-Instruct (72 billion parameters) GPT-OSS-120B (120 billion parameters, MXFP4 quantized) 2 Environments: Native (chroot) vs Container (Docker) 10 Iterations per model per environment Total: 60 benchmark runs Methodology Framework: TensorRT-LLM (trtllm-bench CLI) Workload: 50 requests, 128 output tokens per request Cooldown: 5 minutes &#43; GPU temp check (&lt; 45°C) between runs Duration: ~14 hours total Metrics: Peak memory, KV cache, throughput, latency, temperature DeepSeek-7B Results My smallest model, but the most shocking results:
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-11-08 13:00:00 +0000 +0000'>November 8, 2025</span>&nbsp;·&nbsp;<span>4 min</span>&nbsp;·&nbsp;<span>Brandon Geraci</span></footer>
  <a class="entry-link" aria-label="post link to The Data: 60 Runs Don&#39;t Lie" href="https://brandonrc.github.io/dgx-spark-blog/posts/04-the-data/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">The Unified Memory Revelation: Why Docker Double-Counts
    </h2>
  </header>
  <div class="entry-content">
    <p>The Question That Started It All After getting both Docker and native environments working, I could finally run proper benchmarks. But I kept asking myself:
“Where is the 26GB going?”
It wasn’t CPU overhead - containers don’t add 26GB of process memory.
It wasn’t the Docker daemon - that’s tiny.
It wasn’t duplicate libraries - bind mounts prevent that.
So… where?
Traditional GPU Systems (The Old Way) Let’s start with how most GPU systems work. Take an NVIDIA H100 or A100:
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-11-08 12:00:00 +0000 +0000'>November 8, 2025</span>&nbsp;·&nbsp;<span>8 min</span>&nbsp;·&nbsp;<span>Brandon Geraci</span></footer>
  <a class="entry-link" aria-label="post link to The Unified Memory Revelation: Why Docker Double-Counts" href="https://brandonrc.github.io/dgx-spark-blog/posts/03-unified-memory-revelation/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Down the Rabbit Hole: The MPI and Chroot Nightmare
    </h2>
  </header>
  <div class="entry-content">
    <p>The Simple Plan (That Wasn’t Simple) After seeing the mysterious 26GB memory overhead in Docker, my plan was straightforward:
Extract the container’s filesystem Run the same Python scripts natively Compare the results Done! Ha. Hahahaha. No.
Attempt 1: Just Run It My first thought: “Let’s just run the Docker scripts on my system. How hard can it be?”
1 2 python /home/khan/benchmark-spark/benchmarks/trtllm_benchmark.py \ --model deepseek-ai/DeepSeek-R1-Distill-Qwen-7B What I got: Runtime nightmare.
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-11-08 11:00:00 +0000 +0000'>November 8, 2025</span>&nbsp;·&nbsp;<span>6 min</span>&nbsp;·&nbsp;<span>Brandon Geraci</span></footer>
  <a class="entry-link" aria-label="post link to Down the Rabbit Hole: The MPI and Chroot Nightmare" href="https://brandonrc.github.io/dgx-spark-blog/posts/02-mpi-chroot-nightmare/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">The Mystery: Don&#39;t Just Blame the Hardware
    </h2>
  </header>
  <div class="entry-content">
    <p>The YouTube Problem If you search for “DGX Spark performance” on YouTube, you’ll find plenty of videos with clickbait titles like “NVIDIA’s $X Machine is a DISAPPOINTMENT” or “Grace Blackwell: Overhyped and Underdelivering.”
And that really bothers me.
Not because I’m an NVIDIA fanboy (I’m not), but because none of these reviewers provided a technical explanation of why performance wasn’t meeting expectations. They just pointed at benchmark numbers, said “slow,” and moved on. No investigation into kernel settings, driver versions, container configurations, or software stack optimization. Just… blame the hardware.
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-11-08 10:00:00 +0000 +0000'>November 8, 2025</span>&nbsp;·&nbsp;<span>4 min</span>&nbsp;·&nbsp;<span>Brandon Geraci</span></footer>
  <a class="entry-link" aria-label="post link to The Mystery: Don&#39;t Just Blame the Hardware" href="https://brandonrc.github.io/dgx-spark-blog/posts/01-the-mystery/"></a>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://brandonrc.github.io/dgx-spark-blog/">DGX Spark Deep Dive</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
